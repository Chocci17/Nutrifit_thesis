<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NutriFit</title>
  <!-- Shared navbar fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    /* Ensure navbar uses Poppins across pages */
    .navbar, .navbar *{font-family: 'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto, Arial !important}
  </style>
  <link rel="stylesheet" href="main.css">
</head>
<body>

    <video autoplay muted loop playsinline id="bg-video">
    <source src="background.mp4" type="video/mp4">
  </video>
  <div id="bg-video-overlay"></div>
  
 <nav class="navbar"> 
    <div class="navbar-brand">
      <img class="navbar-logo" src="NutriFit.png" alt="NutriFit Logo">
      NutriFit
    </div>
    <div class="navbar-links-container">
      <a href="#home" data-page="home">Home</a>
      <a href="#meal" data-page="Meal.html">Meal</a>
      <a href="#workout" data-page="Workout.html">Workout</a>
      <a href="#about" data-page="About us.html">About us</a>
      <a href="#signup" data-page="signup.html">Sign Up</a>
    </div>
  </nav>

  <div class="hero-section">
    <div class="overlay-content">
      <h1>EAT WELL,<br>LIVE WELL</h1>
      <p>Fuel your fitness journey with meals that power performance and health</p>
      <div class="button-group">
        <button onclick="window.location.href='Meal.html'; return false;">FIND YOUR PLAN</button>
        <button onclick="window.location.href='signup.html'; return false;">START FREE TRIAL</button>
      </div>
    </div>
  </div>

  <!-- Profile Setup Modal -->
  <div id="profileSetupModal" class="profile-setup-modal">
    <div class="profile-setup-container">
      <div class="profile-setup-header">
        <h2>âœ¨ Complete Your Profile</h2>
        <p>Let's personalize your NutriFit experience</p>
      </div>
      
      <form id="profileSetupForm" class="profile-setup-form">
        <!-- Personal Information -->
        <div class="form-section">
          <h3>Personal Information</h3>
          
          <div class="form-group">
            <label for="setupDisplayName">Display Name *</label>
            <input type="text" id="setupDisplayName" placeholder="Enter your display name" required>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="setupAge">Age *</label>
              <input type="number" id="setupAge" placeholder="Age" min="13" max="120" required>
            </div>
            
            <div class="form-group">
              <label for="setupGender">Gender *</label>
              <select id="setupGender" required>
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="setupHeight">Height (cm) *</label>
              <input type="number" id="setupHeight" placeholder="170" min="100" max="250" required>
            </div>
            
            <div class="form-group">
              <label for="setupWeight">Current Weight (kg) *</label>
              <input type="number" id="setupWeight" placeholder="70" min="30" max="300" step="0.1" required>
            </div>
          </div>
        </div>
        
        <!-- Fitness Goals -->
        <div class="form-section">
          <h3>Fitness Goals</h3>
          
          <div class="form-group">
            <label for="setupPrimaryGoal">Primary Goal *</label>
            <select id="setupPrimaryGoal" required>
              <option value="">Select Your Goal</option>
              <option value="Weight Loss">Weight Loss</option>
              <option value="Muscle Gain">Muscle Gain</option>
              <option value="Weight Gain">Weight Gain</option>
              <option value="Maintain Fitness">Maintain Fitness</option>
            </select>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="setupTargetWeight">Target Weight (kg) *</label>
              <input type="number" id="setupTargetWeight" placeholder="65" min="30" max="300" step="0.1" required>
            </div>
            
            <div class="form-group">
              <label for="setupDifficulty">Difficulty *</label>
              <select id="setupDifficulty" required>
                <option value="">Select Difficulty</option>
                <option value="Beginner">Beginner</option>
                <option value="Intermediate">Intermediate</option>
                <option value="Advanced">Advanced</option>
              </select>
            </div>
          </div>
        </div>
        
        <button type="submit" class="setup-submit-btn">Complete Setup</button>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // SPA loader: fetch HTML pages and inject into #spa-content, executing their scripts and adding styles.
    (function(){
      const pages = [
        {id:'home', file:null},
        {id:'Meal.html', file:'Meal.html'},
        {id:'Meal log.html', file:'Meal log.html'},
        {id:'Workout.html', file:'Workout.html'},
        {id:'About us.html', file:'About us.html'},
        {id:'signup.html', file:'signup.html'},
        {id:'login.html', file:'login.html'},
        {id:'Profile.html', file:'Profile.html'},
        {id:'Nutrifit Analytics.html', file:'Nutrifit Analytics.html'},
        {id:'meal suggestions.html', file:'meal suggestions.html'},
        {id:'BMI.html', file:'BMI.html'},
        {id:'exercise plans.html', file:'exercise plans.html'},
        {id:'test-supabase.html', file:'test-supabase.html'}
      ];

      const content = document.createElement('div');
      content.id = 'spa-content';
      document.body.insertBefore(content, document.getElementById('profileSetupModal'));

      // helper: sanitize filename key
      function slug(f){ return f ? f.replace(/\s+/g,'_').replace(/\./g,'') : 'home'; }

      async function loadPage(file){
        if (!file) return; // home uses existing hero
        const key = slug(file);
        let container = document.getElementById('page-'+key);
        if (!container){
          container = document.createElement('section');
          container.id = 'page-'+key;
          container.className = 'spa-page';
          content.appendChild(container);
        }
        // if already loaded, just show
        if (container.dataset.loaded === 'true') return showOnly(container.id);

        try{
          const res = await fetch(file);
          if (!res.ok) throw new Error('Fetch failed: '+res.status);
          const html = await res.text();
          // extract head links/styles
          const headMatches = html.match(/<head[\s\S]*?<\/head>/i);
          if (headMatches){
            const headContent = headMatches[0];
            // add link rel=stylesheet tags
            const linkRe = /<link[^>]+rel=["']stylesheet["'][^>]*>/ig;
            let m;
            while ((m = linkRe.exec(headContent)) !== null){
              const tmp = document.createElement('template'); tmp.innerHTML = m[0];
              const link = tmp.content.firstChild;
              const href = link.getAttribute('href');
              if (href && !document.querySelector('link[href="'+href+'"]')){
                const el = document.createElement('link'); el.rel='stylesheet'; el.href=href; document.head.appendChild(el);
              }
            }
          }

          // extract body content
          const bodyMatch = html.match(/<body[\s\S]*?>([\s\S]*)<\/body>/i);
          const bodyHtml = bodyMatch ? bodyMatch[1] : html;
          container.innerHTML = bodyHtml;

          // run scripts from fetched HTML
          const scriptRe = /<script([^>]*)>([\s\S]*?)<\/script>/ig;
          let sm;
          while ((sm = scriptRe.exec(html)) !== null){
            const attrs = sm[1]; const inline = sm[2];
            const srcMatch = attrs.match(/src=["']([^"']+)["']/i);
            if (srcMatch){
              const s = document.createElement('script'); s.src = srcMatch[1]; s.defer = false; document.body.appendChild(s);
            } else if (inline && inline.trim()){
              const s = document.createElement('script'); s.textContent = inline; document.body.appendChild(s);
            }
          }

          container.dataset.loaded = 'true';
          showOnly(container.id);
        }catch(err){
          container.innerHTML = '<p style="color:darkred">Failed to load page: '+file+' ('+err.message+')</p>';
          showOnly(container.id);
        }
      }

      function showOnly(id){
        document.querySelectorAll('.spa-page').forEach(el=> el.style.display = (el.id===id)?'block':'none');
        // hide hero when not home
        const isHome = id === 'page-home' || id === undefined || id === null;
        const hero = document.querySelector('.hero-section');
        if (hero) hero.style.display = isHome ? 'block' : 'none';
      }

      // set up nav clicks
      document.querySelectorAll('.navbar-links-container a[data-page]').forEach(a=>{
        a.addEventListener('click', (e)=>{
          e.preventDefault(); const file = a.getAttribute('data-page');
          if (!file || file==='home'){
            showOnly(); location.hash = 'home';
          } else { loadPage(file); location.hash = file.replace(/\s+/g,'_'); }
        });
      });

      // on load, check hash
      window.addEventListener('load', ()=>{
        const h = decodeURIComponent(location.hash.replace('#',''));
        if (!h || h==='home') return; // leave hero
        // map hash back to filename (underscores->spaces)
        const file = h.indexOf('.html')>-1 ? h.replace(/_/g,' ') : null;
        if (file) loadPage(file);
      });
    })();
  </script>
  <script src="main.js"></script>
</body>
</html>
